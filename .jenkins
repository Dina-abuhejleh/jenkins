pipeline {
    agent any
    stages {
           stage("set variables"){
               steps{
                   script{
                       def memory =sh(returnStdout: true, script: "free -m | awk 'NR==2{printf \"%.2f%%\",\$3*100/\$2}'")
                       echo "${memory}"
                   }
               }
           }
        stage('Build') {
            steps {
                 sh 'hostname'
                 sh 'free -m'
                 echo "Running ${env.BUILD_ID}"
                 sh 'w'
                 sh 'echo "$memory"'
            }
        }     
    }
}
